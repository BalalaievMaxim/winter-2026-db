# Звіт до лабораторної роботи №4
**Тема**: OLAP

## 1. Базова агрегація

У цьому розділі використовуються функції `SUM`, `AVG`, `MIN`, `MAX`, `COUNT` для отримання статистичних даних з однієї таблиці.

* **Запит 1.1:** Обчислює загальний прибуток спортзалу, підсумовуючи поле `amount` з таблиці `Invoice`, де статус оплати 'paid'. Це дозволяє оцінити фінансовий стан.
* **Запит 1.2:** Знаходить середню ціну абонемента в таблиці `MembershipPlan`. Допомагає зрозуміти цінову політику.
* **Запит 1.3:** Визначає мінімальну та максимальну місткість груп (`capacity`) у таблиці `Class`.
* **Запит 1.4:** Просто рахує кількість зареєстрованих клієнтів у системі.

## 2. Групування даних (GROUP BY)

Дозволяє розбити дані на категорії та обчислити агрегатні функції для кожної категорії окремо.

* **Запит 2.1:** Групує рахунки за статусом (оплачено, очікується тощо) і рахує їх кількість. Корисно для моніторингу заборгованостей.
* **Запит 2.2:** Показує навантаження на тренерів, підраховуючи кількість занять (`Class`), закріплених за кожним `coach_id`.
* **Запит 2.3:** Показує, який метод оплати (картка, готівка) приносить найбільше грошей

## 3. Фільтрування груп (HAVING)

Використовується для відсіювання результатів після групування, оскільки `WHERE` не працює з агрегатними функціями.

* **Запит 3.1:** Відбирає лише тих тренерів, які проводять більше п'яти занять. Допомагає виявити найбільш активних співробітників (наприклад для видачі премії)
* **Запит 3.2:** Показує ID планів членства, які були продані більше ста разів. Допомагає визначити популярні плани.

## 4. Запити з JOIN (Об'єднання таблиць)

Об'єднання даних з декількох таблиць для отримання повної картини.

* **Запит 4.1 (INNER JOIN):** Зв'язує таблиці `Client`, `Membership` та `MembershipPlan`, щоб показати ім'я клієнта та назву його поточного тарифу. Використовується `INNER JOIN`, щоб показати лише клієнтів з активними абонементами.
* **Запит 4.2 (LEFT JOIN):** Виводить список усіх тренерів і кількість їхніх занять. Використання `LEFT JOIN` гарантує, що тренери без призначених занять теж потраплять у список (з кількістю 0).
* **Запит 4.3 (CROSS JOIN):** Створює декартовий добуток усіх клієнтів та всіх типів занять. Це теоретичний запит, корисний для генерації звітів "що можна запропонувати кому".
* **Запит 4.4 (агрегація таблиць):** Ланцюжок джойнів від `ClassType` до `Enrollment` через `Class`. Підраховує реальну кількість людей, записаних на кожен тип тренування (Yoga, Boxing тощо).

## 5. Підзапити

Вкладені запити для складнішої логіки

* **Запит 5.1 (підзапит WHERE):** Знаходить клієнтів, чиї платежі перевищують середній чек по залу (тобто більш багатих). Спочатку обчислюється середнє значення, а потім воно використовується для фільтрації.
* **Запит 5.2 (підзапит SELECT):** Для кожного рядка клієнта виконується окремий підзапит, що рахує його записи в таблиці `Enrollment`. Це альтернатива `GROUP BY` для виведення агрегованих даних разом з деталями.
* **Запит 5.3 (підзапит HAVING):** Знаходить типи занять, середня місткість яких вища за середню місткість усіх занять у клубі (більш відвідувані заняття)